(()=>{var e={};e.id=862,e.ids=[862],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9333:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>R,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>p});var o=t(96559),n=t(48088),i=t(37719),a=t(32190),u=t(87230),c=t(61975);async function p(e){try{let r=await (0,u.N)(e);return a.NextResponse.json({token:r},{headers:{"Cache-Control":"no-store","X-Content-Type-Options":"nosniff"}})}catch(e){if(console.error("Token generation failed:",e),e instanceof Error){if("Too many token generation requests"===e.message)return a.NextResponse.json({error:"Too many requests"},{status:429,headers:{"Retry-After":c.S.rateLimitWindow.toString()}});return a.NextResponse.json({error:e.message||"Token generation failed"},{status:e.statusCode||500})}return a.NextResponse.json({error:"Internal Server Error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/get-token/route",pathname:"/api/get-token",filename:"route",bundlePath:"app/api/get-token/route"},resolvedPagePath:"G:\\PORTFOLIO\\portfolio\\src\\app\\api\\get-token\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:x,serverHooks:g}=d;function R(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},14985:e=>{"use strict";e.exports=require("dns")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},61975:(e,r,t)=>{"use strict";t.d(r,{S:()=>s});let s={algorithm:"HS256",expiration:parseInt(process.env.TOKEN_EXPIRATION||"600"),redisExpiration:parseInt(process.env.REDIS_EXPIRATION||"600"),rateLimitWindow:parseInt(process.env.RATE_LIMIT_WINDOW||"60"),rateLimitMaxRequests:parseInt(process.env.RATE_LIMIT_MAX_REQUESTS||"10")}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},83997:e=>{"use strict";e.exports=require("tty")},86220:(e,r,t)=>{"use strict";t.d(r,{Y:()=>a});var s=t(70300),o=t.n(s);let n=process.env.REDIS_URL;if(!n)throw Error("Redis configuration error: REDIS_URL is required");let i={retryStrategy:e=>Math.min(50*e,2e3),maxRetriesPerRequest:20,connectTimeout:5e3,keepAlive:1e4,tls:n.startsWith("rediss://")?{rejectUnauthorized:!1}:void 0},a=new(o())(n,i);a.on("connect",()=>console.log("✅ Redis connected")).on("ready",()=>console.log("\uD83D\uDE80 Redis ready")).on("error",e=>console.error("❌ Redis error:",e)).on("close",()=>console.warn("\uD83D\uDD0C Redis connection closed")).on("reconnecting",()=>console.log("\uD83D\uDD01 Redis reconnecting...")),process.on("SIGTERM",()=>{a.quit().then(()=>console.log("Redis gracefully terminated"))})},87230:(e,r,t)=>{"use strict";t.d(r,{N:()=>c});var s=t(86220),o=t(43205),n=t.n(o),i=t(55511),a=t(91645),u=t(61975);async function c(e){let r=e.headers.get("x-real-ip")||e.headers.get("x-forwarded-for")?.split(",")[0].trim()||"unknown",t=(0,a.isIP)(r)?r:"invalid";if("invalid"===t)throw Error("Invalid IP address");let o=`rate_limit:contact_token:${t}`,c=await s.Y.incr(o);if(1===c&&await s.Y.expire(o,u.S.rateLimitWindow),!process.env.TRUSTED_IPS?.split(",").includes(t)&&c>u.S.rateLimitMaxRequests)throw await s.Y.expire(o,2*u.S.rateLimitWindow),Error("Too many token generation requests");let p=(0,i.randomUUID)(),d={jti:p,iss:"contact-service",aud:["contact-form","web-app"],iat:Math.floor(Date.now()/1e3),ip:t};if(!process.env.JWT_SECRET)throw Error("JWT_SECRET is not configured");let l={expiresIn:u.S.expiration,algorithm:u.S.algorithm},x=n().sign(d,process.env.JWT_SECRET,l);return await s.Y.set(`contact_token:${p}`,JSON.stringify({status:"valid",createdAt:new Date().toISOString(),ip:t,userAgent:e.headers.get("user-agent")||"unknown",rateLimitCount:c}),"EX",u.S.redisExpiration),x}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,593],()=>t(9333));module.exports=s})();