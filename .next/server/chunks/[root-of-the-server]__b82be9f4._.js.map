{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file://G%3A/PORTFOLIO/portfolio/src/lib/redis.ts"],"sourcesContent":["import Redis, { RedisOptions } from 'ioredis';\r\n\r\nconst redisUrl = process.env.REDIS_URL;\r\n\r\nif (!redisUrl) {\r\n    throw new Error('Redis configuration error: REDIS_URL is required');\r\n}\r\n\r\nconst redisOptions: RedisOptions = {\r\n    retryStrategy: (times) => Math.min(times * 50, 2000),\r\n    maxRetriesPerRequest: 20,\r\n    connectTimeout: 5000,\r\n    keepAlive: 10000,\r\n    tls: redisUrl.startsWith('rediss://') ? { rejectUnauthorized: false } : undefined,\r\n};\r\n\r\nexport const redis = new Redis(redisUrl, redisOptions);\r\n\r\nredis\r\n    .on('connect', () => console.log('‚úÖ Redis connected'))\r\n    .on('ready', () => console.log('üöÄ Redis ready'))\r\n    .on('error', (err) => console.error('‚ùå Redis error:', err))\r\n    .on('close', () => console.warn('üîå Redis connection closed'))\r\n    .on('reconnecting', () => console.log('üîÅ Redis reconnecting...'));\r\n\r\n// Graceful shutdown\r\nprocess.on('SIGTERM', () => {\r\n    redis.quit().then(() => console.log('Redis gracefully terminated'));\r\n});\r\n\r\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,WAAW,QAAQ,GAAG,CAAC,SAAS;AAEtC,IAAI,CAAC,UAAU;IACX,MAAM,IAAI,MAAM;AACpB;AAEA,MAAM,eAA6B;IAC/B,eAAe,CAAC,QAAU,KAAK,GAAG,CAAC,QAAQ,IAAI;IAC/C,sBAAsB;IACtB,gBAAgB;IAChB,WAAW;IACX,KAAK,SAAS,UAAU,CAAC,eAAe;QAAE,oBAAoB;IAAM,IAAI;AAC5E;AAEO,MAAM,QAAQ,IAAI,2IAAA,CAAA,UAAK,CAAC,UAAU;AAEzC,MACK,EAAE,CAAC,WAAW,IAAM,QAAQ,GAAG,CAAC,sBAChC,EAAE,CAAC,SAAS,IAAM,QAAQ,GAAG,CAAC,mBAC9B,EAAE,CAAC,SAAS,CAAC,MAAQ,QAAQ,KAAK,CAAC,kBAAkB,MACrD,EAAE,CAAC,SAAS,IAAM,QAAQ,IAAI,CAAC,+BAC/B,EAAE,CAAC,gBAAgB,IAAM,QAAQ,GAAG,CAAC;AAE1C,oBAAoB;AACpB,QAAQ,EAAE,CAAC,WAAW;IAClB,MAAM,IAAI,GAAG,IAAI,CAAC,IAAM,QAAQ,GAAG,CAAC;AACxC","debugId":null}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file://G%3A/PORTFOLIO/portfolio/src/app/api/get-token/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { redis } from '@/lib/redis';\r\nimport jwt from 'jsonwebtoken';\r\nimport { randomUUID } from 'crypto';\r\nimport { isIP } from 'net';\r\n\r\n// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π\r\nconst JWT_ALGORITHM = 'HS256' as const;\r\nconst TOKEN_EXPIRATION = process.env.TOKEN_EXPIRATION || '10m';\r\nconst REDIS_EXPIRATION = parseInt(process.env.REDIS_EXPIRATION || '600');\r\nconst RATE_LIMIT_WINDOW = parseInt(process.env.RATE_LIMIT_WINDOW || '60');\r\nconst RATE_LIMIT_MAX_REQUESTS = parseInt(process.env.RATE_LIMIT_MAX_REQUESTS || '10');\r\n\r\nexport async function GET(request: NextRequest) {\r\n    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è IP —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤\r\n    const ipHeader = request.headers.get('x-real-ip') ||\r\n        request.headers.get('x-forwarded-for')?.split(',')[0].trim() ||\r\n        'unknown';\r\n    const ip = isIP(ipHeader) ? ipHeader : 'invalid';\r\n\r\n\r\n    if (ip === 'invalid') {\r\n        return NextResponse.json(\r\n            { error: 'Invalid IP address' },\r\n            { status: 400 }\r\n        );\r\n    }\r\n\r\n    const redisRateLimitKey = `rate_limit:contact_token:${ip}`;\r\n    const currentCount = await redis.incr(redisRateLimitKey);\r\n\r\n    try {\r\n        // Rate-limiting —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö IP\r\n        const isTrustedIP = process.env.TRUSTED_IPS?.split(',').includes(ip);\r\n        if (!isTrustedIP && currentCount > RATE_LIMIT_MAX_REQUESTS) {\r\n            await redis.expire(redisRateLimitKey, RATE_LIMIT_WINDOW * 2); // –£–∂–µ—Å—Ç–æ—á–∞–µ–º –ª–∏–º–∏—Ç –ø—Ä–∏ –∞—Ç–∞–∫–µ\r\n            return NextResponse.json(\r\n                { error: 'Too many requests' },\r\n                {\r\n                    status: 429,\r\n                    headers: { 'Retry-After': RATE_LIMIT_WINDOW.toString() }\r\n                }\r\n            );\r\n        }\r\n\r\n        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —Å —É—Å–∏–ª–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é\r\n        const jti = randomUUID();\r\n        const payload = {\r\n            jti,\r\n            iss: 'contact-service',\r\n            aud: ['contact-form', 'web-app'], // Multiple audiences\r\n            iat: Math.floor(Date.now() / 1000), // Issued at\r\n            ip // –î–æ–±–∞–≤–ª—è–µ–º IP –≤ payload –¥–ª—è –∞—É–¥–∏—Ç–∞\r\n        };\r\n\r\n        if (!process.env.JWT_SECRET) {\r\n            throw new Error('JWT_SECRET is not configured');\r\n        }\r\n\r\n        const token = jwt.sign(payload, process.env.JWT_SECRET, {\r\n            expiresIn: TOKEN_EXPIRATION,\r\n            algorithm: JWT_ALGORITHM,\r\n            header: {\r\n                typ: 'JWT',\r\n                kid: 'v1' // Key ID –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤\r\n            }\r\n        } as jwt.SignOptions\r\n        );\r\n\r\n        // –ó–∞–ø–∏—Å—å –≤ Redis —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏\r\n        await redis.set(`contact_token:${jti}`, JSON.stringify({\r\n            status: 'valid',\r\n            createdAt: new Date().toISOString(),\r\n            ip,\r\n            userAgent: request.headers.get('user-agent') || 'unknown',\r\n            rateLimitCount: currentCount\r\n        }), 'EX', REDIS_EXPIRATION);\r\n\r\n        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Security Information and Event Management (SIEM)\r\n        console.info(`Token issued for IP: ${ip}`, {\r\n            jti,\r\n            rateLimit: currentCount\r\n        });\r\n\r\n        return NextResponse.json({ token }, {\r\n            headers: {\r\n                'Cache-Control': 'no-store',\r\n                'X-Content-Type-Options': 'nosniff'\r\n            }\r\n        });\r\n\r\n    } catch (error) {\r\n        // –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫\r\n        console.error('Token generation failed:', {\r\n            error: error instanceof Error ? error.stack : error,\r\n            ip,\r\n            headers: Object.fromEntries(request.headers.entries())\r\n        });\r\n\r\n        return NextResponse.json(\r\n            { error: 'Internal Server Error' },\r\n            {\r\n                status: 500,\r\n                headers: { 'X-Error-Code': 'TOKEN_GENERATION_FAILED' }\r\n            }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}